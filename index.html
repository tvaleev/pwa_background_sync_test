<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Background Sync Demo</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#4285F4" />
</head>
<body>
  <h1>Background Sync Test</h1>
  <button id="registerSync">Register Sync</button>
  <p id="status">Status: <span id="state">unknown</span></p>

  <script>
    // Check support
    if ('serviceWorker' in navigator && 'SyncManager' in window) {
      navigator.serviceWorker.register('sw.js').then(reg => {
        console.log('Service Worker registered.');

        document.getElementById('registerSync').addEventListener('click', async () => {
          try {
            await Notification.requestPermission();
            await reg.sync.register('test-sync');
            console.log('Background sync registered');
          } catch (err) {
            console.error('Sync registration failed:', err);
          }
        });
      });
    } else {
      console.warn('Background sync not supported in this browser.');
    }

    // Connectivity indicator
    function updateStatus() {
      document.getElementById('state').textContent = navigator.onLine ? 'Online' : 'Offline';
    }
    window.addEventListener('online', updateStatus);
    window.addEventListener('offline', updateStatus);
    updateStatus();
  </script>
</body>
</html>
